
-- criação das tabelas --

CREATE TABLE MATRICULA (
	NR_ANO NUMBER(4) NOT NULL,
	CD_CUR NUMBER(5) NOT NULL,
	CD_ALU NUMBER(5) NOT NULL,
	ST_MATR VARCHAR2(1) NOT NULL
);


CREATE TABLE PARCELA (
	NR_ANO NUMBER(4) NOT NULL,
	CD_CUR NUMBER(5) NOT NULL,
	CD_ALU NUMBER(5) NOT NULL,
	NR_PAR NUMBER(5) NOT NULL,
	DT_VCTO DATE NOT NULL,
	VL_PAR NUMBER(9,2) NOT NULL,
	DT_PGTO DATE,
	VL_PGTO NUMBER(9,2)
);



-- adição das primary keys --

ALTER TABLE MATRICULA
	ADD CONSTRAINT MAT_PK
	PRIMARY KEY (NR_ANO, CD_CUR, CD_ALU);


ALTER TABLE PARCELA
	ADD CONSTRAINT PAR_PK
	PRIMARY KEY (NR_ANO, CD_CUR, CD_ALU, NR_PAR);



-- adição das foreign keys --

ALTER TABLE MATRICULA
	ADD CONSTRAINT MAT_ALU_FK
	FOREIGN KEY (CD_ALU)
	REFERENCES ALUNO (CD_ALU);


ALTER TABLE MATRICULA
	ADD CONSTRAINT MAT_CUR_FK
	FOREIGN KEY (CD_CUR)
	REFERENCES CURSO (CD_CUR);


ALTER TABLE PARCELA
	ADD CONSTRAINT PAR_MAT_FK
	FOREIGN KEY (NR_ANO, CD_CUR, CD_ALU)
	REFERENCES MATRICULA (NR_ANO, CD_CUR, CD_ALU);


-- adição das check constraints --

ALTER TABLE MATRICULA
	ADD CONSTRAINT ST_MATR_CK
	CHECK (ST_MATR IN ('D', 'M', 'T'));



-- criação dos índices --

CREATE INDEX MAT_ALU_FK_I ON MATRICULA (CD_ALU);

CREATE INDEX MAT_CUR_FK_I ON MATRICULA (CD_CUR);

CREATE INDEX PAR_MAT_FK_I ON PARCELA (NR_ANO, CD_CUR, CD_ALU);