-- TABLELA CLIENTE --

CREATE TABLE CLIENTE(
	  CD_CLI NUMBER(5) NOT NULL,
	  NM_CLI VARCHAR2(30) NOT NULL,
	  TP_SEX CHAR(1)
);


ALTER TABLE CLIENTE
	  ADD CONSTRAINT CLI_PK
	  PRIMARY KEY(CD_CLI);

	  
ALTER TABLE CLIENTE
	  ADD CONSTRAINT TP_SEX_CK
	  CHECK(TP_SEX IN ('M', 'F'));

	  
CREATE INDEX NM_CLI_I ON CLIENTE(NM_CLIE);



-- TABELA PRODUTO --

CREATE TABLE PRODUTO(
	   CD_PRO NUMBER(5) NOT NULL,
	   NM_PRO VARCHAR2(30) NOT NULL,
	   QT_EST NUMBER(9, 2) NOT NULL
);


ALTER TABLE PRODUTO
	   ADD CONSTRAINT PRO_PK
	   PRIMARY KEY(CD_PRO);
	   

ALTER TABLE PRODUTO
	   ADD CONSTRAINT QT_EST_CK
	   CHECK(QT_EST > 0);
	   
	   
-- TABELA VENDA --

CREATE TABLE VENDA (
	   CD_VEN NUMBER(5) NOT NULL,
	   DT_VEN DATE NOT NULL,
	   CD_CLI NUMBER(5) NOT NULL
);


ALTER TABLE VENDA
	   ADD CONSTRAINT VEN_PK
	   PRIMARY KEY(CD_VEN, CD_CLI);
	   
	   
ALTER TABLE VENDA
	   ADD CONSTRAINT VEN_FK
	   FOREIGN KEY (CD_CLI)
	   REFERENCES CLIENTE (CD_CLI);
	   
	   
CREATE INDEX VEN_CLI_FK_I ON VENDA (CD_CLI);


-- TABELA PRODUTO_VENDIDO --

CREATE TABLE PRODUTO_VENDIDO(
	   CD_VEN NUMBER(5) NOT NULL,
	   CD_CLI NUMBER(5) NOT NULL,
	   CD_PRO NUMBER(5) NOT NULL,
	   QT_VEN NUMBER(9,2) NOT NULL
);


ALTER TABLE PRODUTO_VENDIDO
	   ADD CONSTRAINT PRV_PK
	   PRIMARY KEY (CD_CLI, CD_VEN, CD_PRO);
	   
ALTER TABLE PRODUTO_VENDIDO
	   ADD CONSTRAINT PRV_PRO_FK
	   FOREIGN KEY (CD_PRO)
	   REFERENCES PRODUTO(CD_PRO);
	   
CREATE INDEX PRV_PRO_FK_I ON PRODUTO_VENDIDO (CD_PRO);

ALTER TABLE PRODUTO_VENDIDO
	   ADD CONSTRAINT PRV_VEN_FK
	   FOREIGN KEY (CD_CLI, CD_VEN)
	   REFERENCES VENDA (CD_CLI, CD_VEN);
	   
CREATE INDEX PRV_VEN_FK_I ON PRODUTO_VENDIDO (CD_CLI, CD_VEN);