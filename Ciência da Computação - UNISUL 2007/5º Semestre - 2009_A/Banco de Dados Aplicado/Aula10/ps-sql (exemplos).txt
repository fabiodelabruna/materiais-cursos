-- Estrutura base de um programa PS/SQL
DECLARE

BEGIN

END;


-- Exemplo de como imprimir na tela
DECLARE
  NOME VARCHAR2(30);
BEGIN
  NOME:='PRIMEIRO TESTE';
  DBMS_OUTPUT.PUT_LINE(NOME);
END;


-- Gravando um select em uma variável.
-- Definindo tipo de variável identico a coluna do banco.
DECLARE
  NOME VENDEDOR.NM_VDD%TYPE;
  NR_VEN NUMBER(5);
BEGIN
  SELECT NM_VDD INTO NOME
   FROM VENDEDOR WHERE CD_VDD = 3;
  SELECT COUNT(*) INTO NR_VEN
   FROM VENDA WHERE CD_VDD = 3;
  DBMS_OUTPUT.PUT_LINE(NOME||' Vendas = '||NR_VEN);
END;


-- Exemplo 1.
DECLARE
  WNM_LOJ LOJA.NM_LOJ%TYPE;
  WNM_CID LOJA.NM_CID%TYPE;
  WDT_VEN VENDA.DT_VEN%TYPE;
  WDT_VCTO PARCELA.DT_VCTO%TYPE;
  WVL_PAR PARCELA.VL_PAR%TYPE;
  WNR_VEN NUMBER(5);
  WNR_PAR NUMBER(5);
  NP NUMBER(5);
BEGIN
  SELECT NM_LOJ,NM_CID INTO WNM_LOJ, WNM_CID
   FROM LOJA WHERE CD_LOJ = 2;
   
  DBMS_OUTPUT.PUT_LINE('Loja: '||WNM_LOJ||' / Cidade: '||WNM_CID);
  
  SELECT COUNT(*) INTO WNR_VEN FROM VENDA WHERE CD_LOJ = 2;
  
  FOR C IN 1..WNR_VEN LOOP
    SELECT DT_VEN, COUNT(*) INTO WDT_VEN, WNR_PAR
	 FROM VENDA V, PARCELA P
	 WHERE V.CD_LOJ = 2 AND V.CD_VEN = C
	 AND V.CD_VEN = P.CD_VEN
	 GROUP BY DT_VEN;
	DBMS_OUTPUT.PUT_LINE('Venda: '||C||' / Data: '||WDT_VEN||' / Qtd. Parcelas: '||WNR_PAR);
  
    NP:=1;
	LOOP
--    WHILE NP<=WNR_PAR LOOP 
	  SELECT DT_VCTO, VL_PAR INTO WDT_VCTO, WVL_PAR
	   FROM PARCELA
	   WHERE CD_LOJ = 2
	   AND CD_VEN = C
	   AND CD_PAR = NP;
	 
	  IF WVL_PAR > 40 THEN 
	    DBMS_OUTPUT.PUT_LINE('Vcto: '||WDT_VCTO||' / Valor Baixo: '||WVL_PAR);
	  ELSIF WVL_PAR >= 100 AND WVL <= 150 THEN
        DBMS_OUTPUT.PUT_LINE('Vcto: '||WDT_VCTO||' / Valor Médio: '||WVL_PAR);
	  ELSE
	    DBMS_OUTPUT.PUT_LINE('Vcto: '||WDT_VCTO||' / Valor Alto: '||WVL_PAR);
	  END IF;
	  
	  NP:=NP + 1;--INCREMENTA A VARIÁVEL CONTADORA 
	  
	  EXIT WHEN NP > WNR_PAR; -- COMANDO UNSADO COM "LOOP" 
	  
	END LOOP;
  
  END LOOP;
  
END;

