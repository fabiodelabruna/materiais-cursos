#include "16F877A.h"
#fuses HS,PROTECT,NOLVP
#use delay(clock=20Mhz)
#include <lcd_4.c>

char leTeclado();

void main(){

   char c =' ';
   lcd_init();
   lcd_gotoxy(1,1);
   while(true){
      c = leTeclado();
      if(c!=' '){
         printf(lcd_putc, "%c", c);
         delay_ms(300);
      }
   }
}

char leTeclado(){
   //selecionei minha coluna c2, primeira coluna
   output_high(pin_c2); 
   output_low(pin_c1);
   output_low(pin_c0);
   
   if(input(pin_c3)){
      return '1';
   }
   if(input(pin_c4)){
      return '4';
   }
   if(input(pin_c5)){
      return '7';
   }
   if(input(pin_c6)){
      return '*';
   }
   
   //selecionei minha coluna c1, segunda coluna
   output_low(pin_c2); 
   output_high(pin_c1);
   output_low(pin_c0);
   
   if(input(pin_c3)){
      return '2';
   }
   if(input(pin_c4)){
      return '5';
   }
   if(input(pin_c5)){
      return '8';
   }
   if(input(pin_c6)){
      return '0';
   }
   
   //selecionei minha coluna c0, terceira coluna
   output_low(pin_c2); 
   output_low(pin_c1);
   output_high(pin_c0);
   
   if(input(pin_c3)){
      return '3';
   }
   if(input(pin_c4)){
      return '6';
   }
   if(input(pin_c5)){
      return '9';
   }
   if(input(pin_c6)){
      return '#';
   }
   
   return ' ';
}
