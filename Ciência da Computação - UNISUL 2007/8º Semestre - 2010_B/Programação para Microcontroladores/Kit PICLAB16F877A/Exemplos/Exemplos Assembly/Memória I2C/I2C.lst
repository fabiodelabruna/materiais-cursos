MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;*      *       *       *       *       *       *       *       *       *
                      00002 ;*                                                                      *
                      00003 ;*          EXEMPLO9: UTILIZAÇÃO DA MEMÓRIA DE PROGRAMA DO PIC          *
                      00004 ;*                   APOSTILA MÓDULO B  -  PIC16F877A                   *
                      00005 ;*                    ÁPICE TECNOLOGIA E TREINAMENTO                    *
                      00006 ;*          VERSÃO 1.0                          DATA:03/05/2005         *
                      00007 ;*                                                                      *
                      00008 ;*      *       *       *       *       *       *       *       *       *
                      00009 
                      00010 ;*      *       *       *       *       *       *       *       *       *
                      00011 ;*                       OBJETIVO DO ARQUIVO FONTE                      *
                      00012 ;*                                                                      *
                      00013 ;*              DEMONSTRAR A UTILIZAÇÃO DA EEPROM DO PIC                *
                      00014 ;*                                                                      *
                      00015 ;*      *       *       *       *       *       *       *       *       *
                      00016 
                      00017  #INCLUDE <P16F877.INC>         ;ARQUIVO PADRÃO PARA PIC16F877A
                      00001         LIST
                      00002 ; P16F877.INC  Standard Header File, Version 1.00    Microchip Technology, Inc.
                      00373         LIST
2007   3F35           00018  __CONFIG _CP_OFF & _XT_OSC & _PWRTE_ON & _LVP_OFF & _WDT_ON & _BODEN_OFF & _CPD_OFF & _DEBUG_OFF
                      00019  ERRORLEVEL 2   
                      00020         ;NESTE PONTO É INFORMADO A CONFIGURAÇÃO DA MÁQUINA, OU SEJA, SE TERÁ
                      00021         ;CÓDIGO DE PROTEÇÃO OU O TIPO DE CRISTAL QUE SERÁ UTILIZADO     
                      00022 
                      00023         ;CONFIGURAÇÃO DA MÁQUINA
                      00024         ; CODE PROTECT                  -> DESLIGADO
                      00025         ; OSCILADOR                     -> CRISTAL OU RESSONADOR
                      00026         ; POWER-UP                      -> LIGADO
                      00027         ; DEBUF                         -> DESLIGADO            
                      00028         ; PROGRAMAÇÃO EM BAIXA VOLTAGEM -> DESLIGADO
                      00029         ; WATCH DOG                     -> LIGADO
                      00030         ; BROWN-OUT RESET               -> DESLIGADO
                      00031         ; PROTEÇÃO DE EEPROM            -> DESLIGADO
                      00032                 
                      00033 ;*      *       *       *       *       *       *       *       *       *
                      00034 ;*                         PAGINAÇÃO DE MEMÓRIA                         *
                      00035 ;*      *       *       *       *       *       *       *       *       *
                      00036 
                      00037 ; AQUI CRIAREMOS UM PSEUDÔNIMO PARA UM COMANDO. POR EXEMPLO, O COMANDO
                      00038 ; "BCF STATUS,RP0" PODE SER SUBSTITUÍDO SEM PROBLEMAS POR "BANK0". O 
                      00039 ; COMPILADOR IRÁ SUBSTITUIR INTERNAMENTE "BANK0" POR "BCF STATUS,RP0".
                      00040 ; ESTA APLICAÇÃO É VÁLIDA PARA OUTROS TIPOS DE COMANDOS
                      00041 
                      00042 #DEFINE BANK0   BCF     STATUS,RP0      ; ESCOLHE BANCO DE MEMÓRIA 0
                      00043 #DEFINE BANK1   BSF     STATUS,RP0      ; ESCOLHE BANCO DE MEMÓRIA 1
                      00044 
                      00045 ;*      *       *       *       *       *       *       *       *       *
                      00046 ;*                           DEFINICAO DE RAM                           *
                      00047 ;*      *       *       *       *       *       *       *       *       *
                      00048 
                      00049 ; AQUI IREMOS CRIAR AS VARIÁVEIS DO NOSSO SISTEMA
                      00050 
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00051         CBLOCK 0x20      ; INÍCIO DO BLOCO DE RAM(GPR)
  00000020            00052                 TEMPO1   ; VARIÁVEL DA ROTINA DE TEMPO          
  00000021            00053                 TEMPO2   ; VARIÁVEL DA ROTINA DE TEMPO                          
  00000022            00054                 TECLADO1 ; VARIÁVEL PARA MARCAR AS TECLAS  
  00000023            00055                 TECLADO2 ; VARIÁVEL PARA MARCAR AS TECLAS
  00000024            00056                 INDICE   ; VARIÁVEL DE ÍNDICE
  00000025            00057                 TEMP     ; VARIÁVEL TEMPORÁRIA          
  00000026            00058                 BUFFER0  ; BUFFER PARA ARMAZENAR O BYTE
  00000027            00059                 BUFFER1  ; BUFFER PARA ARMAZENAR O BYTE
  00000028            00060                 BUFFER2  ; BUFFER PARA ARMAZENAR O BYTE
  00000029            00061                 BUFFER3  ; BUFFER PARA ARMAZENAR O BYTE
  0000002A            00062                 BUFFER4  ; BUFFER PARA ARMAZENAR O BYTE
  0000002B            00063                 BUFFER5  ; BUFFER PARA ARMAZENAR O BYTE
  0000002C            00064                 BUFFER6  ; BUFFER PARA ARMAZENAR O BYTE
  0000002D            00065                 BUFFER7  ; BUFFER PARA ARMAZENAR O BYTE
  0000002E            00066                 BUFFER8  ; BUFFER PARA ARMAZENAR O BYTE
  0000002F            00067                 BUFFER9  ; BUFFER PARA ARMAZENAR O BYTE
  00000030            00068                 BUFFER10 ; BUFFER PARA ARMAZENAR O BYTE
  00000031            00069                 BUFFER11 ; BUFFER PARA ARMAZENAR O BYTE
  00000032            00070                 BUFFER12 ; BUFFER PARA ARMAZENAR O BYTE
  00000033            00071                 BUFFER13 ; BUFFER PARA ARMAZENAR O BYTE
  00000034            00072                 BUFFER14 ; BUFFER PARA ARMAZENAR O BYTE
  00000035            00073                 BUFFER15 ; BUFFER PARA ARMAZENAR O BYTE
  00000036            00074                 INDICE_BUFFER ; INDICE PARA O BUFFER
                      00075                 
  00000037            00076                 ENDERECO_HI ; VARIÁVEIS PARA CONTROLE DO        
  00000038            00077                 ENDERECO_LO ; ENDEREÇO DA EEPROM E FLASH
  00000039            00078                 BUFFER_I2C
                      00079                 
                      00080         ENDC             ; FIM DO BLOCO DE RAM(GPR)
                      00081         
                      00082         CBLOCK 0x70
  00000070            00083                 W_TEMP   ; VARIÁVEIS TEMPORÁRIAS
  00000071            00084                 STATUS_TEMP     
  00000072            00085                 FSR_TEMP
  00000073            00086                 PCLATH_TEMP
                      00087         ENDC
                      00088                 
                      00089 ;*      *       *       *       *       *       *       *       *       *
                      00090 ;*                        DEFINICAO DE FLAGS                            *
                      00091 ;*      *       *       *       *       *       *       *       *       *
                      00092 
                      00093 ; AQUI SÃO DEFINIDOS OS FLAGS QUE SERÃO UTILIZADOS PELO SISTEMA
                      00094 
                      00095 #DEFINE  TECLA_0        TECLADO1,0  ; TECLA 0 DO TECLADO MATRICIAL
                      00096 #DEFINE  TECLA_1        TECLADO1,1  ; TECLA 1 DO TECLADO MATRICIAL      
                      00097 #DEFINE  TECLA_2        TECLADO1,2  ; TECLA 2 DO TECLADO MATRICIAL      
                      00098 #DEFINE  TECLA_3        TECLADO1,3  ; TECLA 3 DO TECLADO MATRICIAL
                      00099 #DEFINE  TECLA_4        TECLADO1,4  ; TECLA 4 DO TECLADO MATRICIAL
                      00100 #DEFINE  TECLA_5        TECLADO1,5  ; TECLA 5 DO TECLADO MATRICIAL
                      00101 #DEFINE  TECLA_6        TECLADO1,6  ; TECLA 6 DO TECLADO MATRICIAL
                      00102 #DEFINE  TECLA_7        TECLADO1,7  ; TECLA 7 DO TECLADO MATRICIAL
                      00103 #DEFINE  TECLA_8        TECLADO2,0  ; TECLA 8 DO TECLADO MATRICIAL
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00104 #DEFINE  TECLA_9        TECLADO2,1  ; TECLA 9 DO TECLADO MATRICIAL
                      00105 #DEFINE  TECLA_C        TECLADO2,2  ; TECLA CORRIGE DO TECLADO MATRICIAL
                      00106 #DEFINE  TECLA_E        TECLADO2,3  ; TECLA ENTER DO TECLADO MATRICIAL
                      00107         
                      00108 ;*      *       *       *       *       *       *       *       *       *
                      00109 ;*                      DEFINICAO DE CONSTANTES                         *
                      00110 ;*      *       *       *       *       *       *       *       *       *
                      00111 
                      00112 ; AQUI SÃO DEFINIDOS AS CONSTANTES QUE SERÃO UTILIZADOS PELO SISTEMA
                      00113 
                      00114 #DEFINE LINHA_SUP       0x80    ; CONSTANTE PARA LINHA SUPERIOR
                      00115 #DEFINE LINHA_INF       0xC0    ; CONSTANTE PARA LINHA INFERIOR
                      00116 #DEFINE TEMPO_BEEP      .10     ; CONSTANTE PARA TOCAR BEEP(MULTIPLOS DE 1ms) 
                      00117 
                      00118 #DEFINE SEL_LINHA1      B'00001110'  ; SELECIONA LINHA 1        
                      00119 #DEFINE SEL_LINHA2      B'00001101'  ; SELECIONA LINHA 2                
                      00120 #DEFINE SEL_LINHA3      B'00001011'  ; SELECIONA LINHA 3                
                      00121 #DEFINE SEL_LINHA4      B'00000111'  ; SELECIONA LINHA 4        
                      00122 
                      00123 ;*      *       *       *       *       *       *       *       *       *
                      00124 ;*                        ENTRADAS DO SISTEMA                           *
                      00125 ;*      *       *       *       *       *       *       *       *       *
                      00126 
                      00127 #DEFINE COL1            PORTA,4      ; PINO DE ENTRADA DA COLUNA1       
                      00128 #DEFINE COL2            PORTA,5      ; PINO DE ENTRADA DA COLUNA2               
                      00129 #DEFINE COL3            PORTE,0      ; PINO DE ENTRADA DA COLUNA3               
                      00130 
                      00131 ;*      *       *       *       *       *       *       *       *       *
                      00132 ;*                        SAÍDAS DO SISTEMA                             *
                      00133 ;*      *       *       *       *       *       *       *       *       *
                      00134 
                      00135 ; AQUI SÃO DEFINIDAS AS SAÍDAS QUE SERÃO UTILIZADOS PELO SISTEMA
                      00136 
                      00137 #DEFINE BUS             PORTD   ; DEFINE O BARRAMENTO COMO O PORTD 
                      00138 #DEFINE RS              PORTE,1 ; RS DO DISPLAY
                      00139 #DEFINE EN              PORTE,2 ; EN DO DISPLAY
                      00140 #DEFINE BEEP            PORTC,5 ; SAÍDA PARA LIGAR O BEEP
                      00141 
                      00142 ;*      *       *       *       *       *       *       *       *       *
                      00143 ;*                      INICIALIZAÇÃO DA EEPROM                         *
                      00144 ;*      *       *       *       *       *       *       *       *       *
                      00145 
2100                  00146         ORG     0x2100
2100   0041 0070 0069 00147         DE      "Apice Treinamen."
       0063 0065 0020 
       0054 0072 0065 
       0069 006E 0061 
       006D 0065 006E 
       002E 
                      00148 
                      00149 ;*      *       *       *       *       *       *       *       *       *
                      00150 ;*                          VETOR DE RESET                              *
                      00151 ;*      *       *       *       *       *       *       *       *       *
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00152 
0000                  00153         ORG     0x0000          ; ENDEREÇO INICIAL DA MÁQUINA
0000   28F5           00154         GOTO    CONFIG_         ; SALTA PARA CONFIGURAR A MÁQUINA
                      00155 
                      00156 ;*      *       *       *       *       *       *       *       *       *
                      00157 ;*                       VETOR DE INTERRUPÇÃO                           *
                      00158 ;*      *       *       *       *       *       *       *       *       *
                      00159 
0004                  00160         ORG     0x0004          ; ENDEREÇO INICIAL DO VETOR DE INTERRUPÇÃO
0004                  00161 SALVA_CONTEXTO
0004   00F0           00162         MOVWF   W_TEMP          ; SALVA W
0005   0E03           00163         SWAPF   STATUS,W        
0006   00F1           00164         MOVWF   STATUS_TEMP     ; SALVA STATUS
0007   0804           00165         MOVF    FSR,W
0008   00F2           00166         MOVWF   FSR_TEMP        ; SALVA FSR     
0009   080A           00167         MOVF    PCLATH,W        
000A   00F3           00168         MOVWF   PCLATH_TEMP     ; SALVA PCLATH
                      00169         
000B   0183           00170         CLRF    STATUS          ; GARANTE BANCO 0
000C   018A           00171         CLRF    PCLATH          ; GARANTE PÁGINA 0
                      00172         
000D   1A8C           00173         BTFSC   PIR1,RCIF       ; INTERRUPÇÃO SERIAL?
000E   2853           00174         GOTO    TRATA_SERIAL    ; SIM, ENTÃO TRATA
                      00175         
000F   190B           00176         BTFSC   INTCON,T0IF     ; INTERRUPÇÃO DE TIMER0?
0010   281A           00177         GOTO    TRATA_TIMER0    ; SIM, ENTÃO TRATA
                      00178         
0011                  00179 SAI_INTERRUPCAO 
0011   0872           00180         MOVF    FSR_TEMP,W
0012   0084           00181         MOVWF   FSR             ; RECUPERA FSR
0013   0873           00182         MOVF    PCLATH_TEMP,W   
0014   008A           00183         MOVWF   PCLATH          ; RECUPERA PCLATH
0015   0E71           00184         SWAPF   STATUS_TEMP,W
0016   0083           00185         MOVWF   STATUS          ; RECUPERA STATUS
0017   0EF0           00186         SWAPF   W_TEMP,F
0018   0E70           00187         SWAPF   W_TEMP,W        ; RECUPERA W
0019   0009           00188         RETFIE                  ; RETORNA DA INTERRUPÇÃO
                      00189 
                      00190 ;*      *       *       *       *       *       *       *       *       *
                      00191 ;*                  TRATATAMENTO DE INTERRUPÇÃO DE TIMER0               *
                      00192 ;*      *       *       *       *       *       *       *       *       *
                      00193 
001A                  00194 TRATA_TIMER0
                      00195         
001A   110B           00196         BCF     INTCON,T0IF      ; LIMPA FLAG DE INTERRUPÇÃO
001B   0AA4           00197         INCF    INDICE           ; INCREMENTA INDICE 
001C   3003           00198         MOVLW   B'00000011'      
001D   0524           00199         ANDWF   INDICE,W         ; MASCARA OS BITS SUPERIORES   
001E   0782           00200         ADDWF   PCL,F            ; SOMA CONTEÚDO COM PCL        
001F   2823           00201         GOTO    VERIFICA_LINHA1  ; SALTA PARA TRATAR A LINHA 1
0020   282F           00202         GOTO    VERIFICA_LINHA2  ; SALTA PARA TRATAR A LINHA 2
0021   283B           00203         GOTO    VERIFICA_LINHA3  ; SALTA PARA TRATAR A LINHA 3
0022   2847           00204         GOTO    VERIFICA_LINHA4  ; SALTA PARA TRATAR A LINHA 4
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00205         
                      00206 
0023                  00207 VERIFICA_LINHA1
                      00208         
0023   300E           00209         MOVLW   SEL_LINHA1      
0024   0088           00210         MOVWF   BUS             ; SELECIONA A LINHA 1   
                      00211         
0025   10A2           00212         BCF     TECLA_1         ; LIMPA FLAG DA TECLA 1 PRESSIONADA
0026   1122           00213         BCF     TECLA_2         ; LIMPA FLAG DA TECLA 2 PRESSIONADA
0027   11A2           00214         BCF     TECLA_3         ; LIMPA FLAG DA TECLA 3 PRESSIONADA
                      00215                 
0028   1E05           00216         BTFSS   COL1            ; COLUNA1 ESTÁ PRESSIONADA?
0029   14A2           00217         BSF     TECLA_1         ; SIM, ENTÃO SETA TECLA_1
                      00218         
002A   1E85           00219         BTFSS   COL2            ; COLUNA2 ESTÁ PRESSIONADA?
002B   1522           00220         BSF     TECLA_2         ; SIM, ENTÃO SETA TECLA_2
                      00221         
002C   1C09           00222         BTFSS   COL3            ; COLUNA3 ESTÁ PRESSIONADA?
002D   15A2           00223         BSF     TECLA_3         ; SIM, ENTÃO SETA TECLA_3
                      00224         
002E   2811           00225         GOTO    SAI_INTERRUPCAO ; SAI DA INTERRUPÇÃO
                      00226         
002F                  00227 VERIFICA_LINHA2
                      00228         
002F   300D           00229         MOVLW   SEL_LINHA2
0030   0088           00230         MOVWF   BUS             ; SELECIONA A LINHA 2   
                      00231         
0031   1222           00232         BCF     TECLA_4         ; LIMPA FLAG DA TECLA 4 PRESSIONADA
0032   12A2           00233         BCF     TECLA_5         ; LIMPA FLAG DA TECLA 5 PRESSIONADA
0033   1322           00234         BCF     TECLA_6         ; LIMPA FLAG DA TECLA 6 PRESSIONADA
                      00235                 
0034   1E05           00236         BTFSS   COL1            ; COLUNA1 ESTÁ PRESSIONADA?
0035   1622           00237         BSF     TECLA_4         ; SIM, ENTÃO SETA TECLA_4
                      00238         
0036   1E85           00239         BTFSS   COL2            ; COLUNA2 ESTÁ PRESSIONADA?
0037   16A2           00240         BSF     TECLA_5         ; SIM, ENTÃO SETA TECLA_5
                      00241         
0038   1C09           00242         BTFSS   COL3            ; COLUNA3 ESTÁ PRESSIONADA?
0039   1722           00243         BSF     TECLA_6         ; SIM, ENTÃO SETA TECLA_6
                      00244         
003A   2811           00245         GOTO    SAI_INTERRUPCAO ; SAI DA INTERRUPÇÃO
                      00246 
003B                  00247 VERIFICA_LINHA3
                      00248         
003B   300B           00249         MOVLW   SEL_LINHA3
003C   0088           00250         MOVWF   BUS             ; SELECIONA A LINHA 3   
                      00251         
003D   13A2           00252         BCF     TECLA_7         ; LIMPA FLAG DA TECLA 7 PRESSIONADA
003E   1023           00253         BCF     TECLA_8         ; LIMPA FLAG DA TECLA 8 PRESSIONADA
003F   10A3           00254         BCF     TECLA_9         ; LIMPA FLAG DA TECLA 9 PRESSIONADA
                      00255                 
0040   1E05           00256         BTFSS   COL1            ; COLUNA1 ESTÁ PRESSIONADA?
0041   17A2           00257         BSF     TECLA_7         ; SIM, ENTÃO SETA TECLA_7
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00258         
0042   1E85           00259         BTFSS   COL2            ; COLUNA2 ESTÁ PRESSIONADA?
0043   1423           00260         BSF     TECLA_8         ; SIM, ENTÃO SETA TECLA_8
                      00261         
0044   1C09           00262         BTFSS   COL3            ; COLUNA3 ESTÁ PRESSIONADA?
0045   14A3           00263         BSF     TECLA_9         ; SIM, ENTÃO SETA TECLA_9
                      00264         
0046   2811           00265         GOTO    SAI_INTERRUPCAO ; SAI DA INTERRUPÇÃO
                      00266 
0047                  00267 VERIFICA_LINHA4
                      00268         
0047   3007           00269         MOVLW   SEL_LINHA4      
0048   0088           00270         MOVWF   BUS             ; SELECIONA A LINHA 4   
                      00271         
0049   11A3           00272         BCF     TECLA_E         ; LIMPA FLAG DA TECLA ENTER PRESSIONADA
004A   1123           00273         BCF     TECLA_C         ; LIMPA FLAG DA TECLA CORRIGE PRESSIONADA
004B   1022           00274         BCF     TECLA_0         ; LIMPA FLAG DA TECLA 0 PRESSIONADA
                      00275                 
004C   1E05           00276         BTFSS   COL1            ; COLUNA1 ESTÁ PRESSIONADA?
004D   1523           00277         BSF     TECLA_C         ; SIM, ENTÃO SETA TECLA_C
                      00278         
004E   1E85           00279         BTFSS   COL2            ; COLUNA2 ESTÁ PRESSIONADA?
004F   1422           00280         BSF     TECLA_0         ; SIM, ENTÃO SETA TECLA_0
                      00281         
0050   1C09           00282         BTFSS   COL3            ; COLUNA3 ESTÁ PRESSIONADA?
0051   15A3           00283         BSF     TECLA_E         ; SIM, ENTÃO SETA TECLA_E
                      00284         
0052   2811           00285         GOTO    SAI_INTERRUPCAO ; SAI DA INTERRUPÇÃO
                      00286 
                      00287 ;*      *       *       *       *       *       *       *       *       *
                      00288 ;*                  TRATATAMENTO DE INTERRUPÇÃO SERIAL                  *
                      00289 ;*      *       *       *       *       *       *       *       *       *
                      00290 
0053                  00291 TRATA_SERIAL
                      00292         
0053   3010           00293         MOVLW   .16             
0054   0636           00294         XORWF   INDICE_BUFFER,W 
0055   1D03           00295         BTFSS   STATUS,Z        ; INDICE_BUFFER CHEGOU A 16?
0056   285A           00296         GOTO    TRATA_SERIAL_A  ; NÃO, ENTÃO SALTA PARA TRATA_SERIAL_A
0057   01B6           00297         CLRF    INDICE_BUFFER   ; SIM, ENTÃO LIMPA O ÍNDICE
0058   3080           00298         MOVLW   0x80            ; MOVE O PONTEIRO DO DISPLAY PARA A 
0059   207D           00299         CALL    ENVIA_COMANDO_INT ; PRIMEIRA LINHA E PRIMEIRA COLUNA
                      00300 
005A                  00301 TRATA_SERIAL_A
                      00302         
005A   3026           00303         MOVLW   BUFFER0         ; PREPARA O PONTEIRO
005B   0736           00304         ADDWF   INDICE_BUFFER,W
005C   0084           00305         MOVWF   FSR
005D   0AB6           00306         INCF    INDICE_BUFFER
                      00307         
005E   081A           00308         MOVF    RCREG,W         
005F   0080           00309         MOVWF   INDF            ; SALVA O DADO NO PONTEIRO
0060   207E           00310         CALL    ENVIA_DADO_INT  ; CHAMA ROTINA PARA ENVIAR O DADO 
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00311                                 ; O DISPLAY
0061   2811           00312         GOTO    SAI_INTERRUPCAO ; SAI DA INTERRUPÇÃO
                      00313 
                      00314 ;*      *       *       *       *       *       *       *       *       *
                      00315 ;*                        ROTINA PARA TOCAR O BEEP                      *
                      00316 ;*      *       *       *       *       *       *       *       *       *
                      00317 
0062                  00318 TOCA_BEEP
                      00319         
0062   1687           00320         BSF     BEEP            ; LIGA O BEEP
0063   30C8           00321         MOVLW   .200            
0064   2067           00322         CALL    DELAY_MS        ; AGUARDA 200ms
0065   1287           00323         BCF     BEEP            ; DESLIGA O BEEP
0066   0008           00324         RETURN                  ; RETORNA
                      00325                                 
                      00326 ;*      *       *       *       *       *       *       *       *       *
                      00327 ;*                    ROTINA DE DELAY DE 1ms A 256ms                    *
                      00328 ;*      *       *       *       *       *       *       *       *       *
                      00329         
0067                  00330 DELAY_MS
                      00331         
0067   0064           00332         CLRWDT
                      00333         
0068   00A1           00334         MOVWF   TEMPO2          ; SALVA O VALOR MULTIPLICADOR
0069   01A0           00335         CLRF    TEMPO1          ; LIMPA REGISTRADOR
                      00336 
006A                  00337 DELAY_A
                      00338         
006A   0000           00339         NOP                     ; PERDE 1 CICLO DE MÁQUINA
006B   0BA0           00340         DECFSZ  TEMPO1,F        ; DECREMENTA REGISTRADOR, ACABOU?
006C   286A           00341         GOTO    $-2             ; NÃO, ENTÃO RETORNA DUAS POSIÇÕES 
006D   0BA1           00342         DECFSZ  TEMPO2,F
006E   286A           00343         GOTO    DELAY_A
                      00344         
006F   0008           00345         RETURN                  ; RETORNA DA INTERRUPÇÃO
                      00346 
                      00347 ;*      *       *       *       *       *       *       *       *       *
                      00348 ;*                ROTINA PARA ESCREVER DADOS NO DISPLAY                 *
                      00349 ;*      *       *       *       *       *       *       *       *       *
                      00350 
0070                  00351 ENVIA_COMANDO
                      00352         
0070   1089           00353         BCF     RS              ; PÕE EM MODO DE COMANDO
                      00354         
0071                  00355 ENVIA_DADO
                      00356         
0071   138B           00357         BCF     INTCON,GIE      ; DESLIGA A INTERRUPÇÃO
                      00358         
0072   0088           00359         MOVWF   BUS             ; MOVE DADO PARA O PORTD
                      00360                 
0073   2874           00361         GOTO    $+1             ; DEÇAY PARA ACOMODAÇÃO
0074   2875           00362         GOTO    $+1             
                      00363         
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0075   1509           00364         BSF     EN              ; GERA PULSO DE CLOCK
0076   2877           00365         GOTO    $+1
0077   1109           00366         BCF     EN
                      00367         
0078   1489           00368         BSF     RS              ; VOLTA PARA O MODO DADOS
0079   3001           00369         MOVLW   .1
007A   2067           00370         CALL    DELAY_MS
007B   178B           00371         BSF     INTCON,GIE      ; LIGA A INTERRUPÇÃO
007C   0008           00372         RETURN                  ; RETORNA DA INTERRUPÇÃO
                      00373 
                      00374 ;*      *       *       *       *       *       *       *       *       *
                      00375 ;*         ROTINA PARA ESCREVER DADOS NO DISPLAY PELA INTERRUPÇÃO       *
                      00376 ;*      *       *       *       *       *       *       *       *       *
                      00377 
007D                  00378 ENVIA_COMANDO_INT
                      00379         
007D   1089           00380         BCF     RS              ; PÕE EM MODO DE COMANDO
                      00381         
007E                  00382 ENVIA_DADO_INT
                      00383         
007E   0088           00384         MOVWF   BUS             ; MOVE DADO PARA O PORTD
                      00385                 
007F   2880           00386         GOTO    $+1             ; DEÇAY PARA ACOMODAÇÃO
0080   2881           00387         GOTO    $+1             
                      00388         
0081   1509           00389         BSF     EN              ; GERA PULSO DE CLOCK
0082   2883           00390         GOTO    $+1
0083   1109           00391         BCF     EN
                      00392         
0084   1489           00393         BSF     RS              ; VOLTA PARA O MODO DADOS
0085   3001           00394         MOVLW   .1
0086   2067           00395         CALL    DELAY_MS
0087   0008           00396         RETURN                  ; RETORNA DA INTERRUPÇÃO
                      00397 
                      00398 ;*      *       *       *       *       *       *       *       *       *
                      00399 ;*                   ROTINA PARA SALVAR O BUFFER NA EEPROM              *
                      00400 ;*      *       *       *       *       *       *       *       *       *
                      00401 
0088                  00402 GUARDA_BUFFER
                      00403         
0088   2062           00404         CALL    TOCA_BEEP       ; CHAMA ROTINA PARA TOCAR O BEEP        
                      00405         
0089   01B8           00406         CLRF    ENDERECO_LO     ; LIMPA O APONTADOR DE ENDEREÇOS
                      00407         
008A   3026           00408         MOVLW   BUFFER0
008B   0084           00409         MOVWF   FSR
                      00410         
008C                  00411 GUARDA_A
                      00412 
008C   0800           00413         MOVF    INDF,W
008D   00B9           00414         MOVWF   BUFFER_I2C
008E   20E4           00415         CALL    ESCREVE_I2C
008F   0A84           00416         INCF    FSR,F
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0090   0AB8           00417         INCF    ENDERECO_LO,F
0091   3010           00418         MOVLW   .16
0092   0638           00419         XORWF   ENDERECO_LO,W
0093   1D03           00420         BTFSS   STATUS,Z
0094   288C           00421         GOTO    GUARDA_A 
                      00422          
0095   0064           00423         CLRWDT
0096   19A3           00424         BTFSC   TECLA_E         ; AGUARDA SOLTAR A TECLA
0097   2895           00425         GOTO    $-2
                      00426         
0098   2062           00427         CALL    TOCA_BEEP       ; CHAMA ROTINA PARA TOCAR O BEEP        
0099   0008           00428         RETURN                  ; RETORNA DA ROTINA
                      00429 
                      00430 ;*      *       *       *       *       *       *       *       *       *
                      00431 ;*                   ROTINA PARA LER O BUFFER DA EEPROM                 *
                      00432 ;*      *       *       *       *       *       *       *       *       *
                      00433 
009A                  00434 LE_DADOS
                      00435         
009A   20DB           00436         CALL    LE_I2C          ; CHAMA ROTINA PARA LER A EEPROM        
009B   2071           00437         CALL    ENVIA_DADO      ; ENVIA O DADO LIDO PARA O DISPLAY
009C   0AB8           00438         INCF    ENDERECO_LO     ; INCREMENTA O APONTADOR DE ENDEREÇOS
009D   3010           00439         MOVLW   .16     
009E   0638           00440         XORWF   ENDERECO_LO,W   ; VERIFICA SE ACABOU DE LER TUDO
009F   1D03           00441         BTFSS   STATUS,Z
00A0   289A           00442         GOTO    LE_DADOS                
                      00443         
00A1   3080           00444         MOVLW   0x80            ; POSICIONA O DISPLAY PARA A PRIMEIRA
00A2   2070           00445         CALL    ENVIA_COMANDO   ; LINHA E PRIMEIRA COLUNA
                      00446                 
00A3   0008           00447         RETURN                  ; RETORNA DA ROTINA     
                      00448 
                      00449 
                      00450 ;*      *       *       *       *       *       *       *       *       *
                      00451 ;*                 ROTINAS DE ACESSO AO BARRAMENTO I2C                  *
                      00452 ;*      *       *       *       *       *       *       *       *       *
                      00453 
                      00454 ;*      *       *       *       *       *       *       *       *       *
                      00455 ;*         ROTINA PARA AGUARDAR PARA AGUARDAR O BARRAMENTO LIVRE        *
                      00456 ;*      *       *       *       *       *       *       *       *       *
                      00457 
00A4                  00458 AGUARDA_I2C
                      00459 
00A4   1683           00460         BANK1
00A5   1914           00461         BTFSC   SSPSTAT,R_W     ; AGUARDA O BARRAMENTO FICAR LIVRE      
00A6   28A5           00462         GOTO    $-1
00A7   0811           00463         MOVF    SSPCON2,W
00A8   391F           00464         ANDLW   B'00011111'
00A9   1D03           00465         BTFSS   STATUS,Z
00AA   28A7           00466         GOTO    $-3
00AB   1283           00467         BANK0
00AC   0008           00468         RETURN                  ; RETORNA
                      00469 
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00470 ;*      *       *       *       *       *       *       *       *       *
                      00471 ;*                        ROTINA PARA ENVIAR NACK                       *
                      00472 ;*      *       *       *       *       *       *       *       *       *
                      00473 
00AD                  00474 ENVIA_NACK
                      00475 
00AD   1683           00476         BANK1
00AE   1691           00477         BSF     SSPCON2,ACKDT   ; ENVIA NACK
00AF   1611           00478         BSF     SSPCON2,ACKEN
00B0   1283           00479         BANK0
00B1   20A4           00480         CALL    AGUARDA_I2C     ; AGUARDA O BARRAMENTO FICAR LIVRE      
00B2   0008           00481         RETURN                  ; RETORNA
                      00482 
                      00483 ;*      *       *       *       *       *       *       *       *       *
                      00484 ;*               ROTINA PARA ENVIAR O START-BIT PARA MEMÓRIA            *
                      00485 ;*      *       *       *       *       *       *       *       *       *
                      00486         
00B3                  00487 ENVIA_START
                      00488 
00B3   1683           00489         BANK1
00B4   1411           00490         BSF     SSPCON2,SEN     ; ENVIA START-BIT
00B5   1283           00491         BANK0
00B6   20A4           00492         CALL    AGUARDA_I2C     ; AGUARDA O BARRAMENTO FICAR LIVRE
00B7   0008           00493         RETURN
                      00494 
                      00495 ;*      *       *       *       *       *       *       *       *       *
                      00496 ;*           ROTINA PARA ENVIAR O ENDEREÇO DE LEITURA DA EEPROM         *
                      00497 ;*      *       *       *       *       *       *       *       *       *
                      00498 
00B8                  00499 ENVIA_ENDERECO
                      00500 
00B8   1003           00501         BCF     STATUS,C
00B9   0D37           00502         RLF     ENDERECO_HI,W   ; ENVIA ENDEREÇO
00BA   38A0           00503         IORLW   B'10100000'
00BB   0093           00504         MOVWF   SSPBUF
00BC   20A4           00505         CALL    AGUARDA_I2C
                      00506         
00BD   0D38           00507         RLF     ENDERECO_LO,W
00BE   0093           00508         MOVWF   SSPBUF
00BF   20A4           00509         CALL    AGUARDA_I2C     ; AGUARDA BARRAMENTO FICAR LIVRE
00C0   0008           00510         RETURN
                      00511 
                      00512 ;*      *       *       *       *       *       *       *       *       *
                      00513 ;*        ROTINA PARA ENVIAR RESTART PARA A MEMÓRIA EEPROM EXTERNA      *
                      00514 ;*      *       *       *       *       *       *       *       *       *
                      00515 
00C1                  00516 ENVIA_RESTART
                      00517 
00C1   1683           00518         BANK1
00C2   1491           00519         BSF     SSPCON2,RSEN    ; ENVIA RESTART
00C3   1283           00520         BANK0
00C4   20A4           00521         CALL    AGUARDA_I2C     ; AGUARDA BARRAMENTO FICAR LIVRE
00C5   0008           00522         RETURN
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00523 
                      00524 ;*      *       *       *       *       *       *       *       *       *
                      00525 ;*    ROTINA PARA ENVIAR PEDIDO DE LEITURA A MEMÓRIA SERIAL EXTERNA     *
                      00526 ;*      *       *       *       *       *       *       *       *       *
                      00527 
00C6                  00528 ENVIA_LEITURA
                      00529         
00C6   0D37           00530         RLF     ENDERECO_HI,W   ; ENVIA COMANDO DE LEITURA
00C7   38A1           00531         IORLW   B'10100001'
00C8   0093           00532         MOVWF   SSPBUF
00C9   20A4           00533         CALL    AGUARDA_I2C     ; AGUARDA O BARRAMENTO FICAR LIVRE
00CA   0008           00534         RETURN                  ; RETORNA
                      00535 
                      00536 ;*      *       *       *       *       *       *       *       *       *
                      00537 ;*               ROTINA PARA LER 1 BYTE DA EEPROM EXTERNA               *
                      00538 ;*      *       *       *       *       *       *       *       *       *
                      00539 
00CB                  00540 LE_BYTE_I2C
                      00541         
00CB   1683           00542         BANK1
00CC   1591           00543         BSF     SSPCON2,RCEN    ; INCIA LEITURA DE DADOS
00CD   1283           00544         BANK0
00CE   20A4           00545         CALL    AGUARDA_I2C     ; AGUARDA O BARRAMENTO FICAR LIVRE 
00CF   0813           00546         MOVF    SSPBUF,W        ; MOVE O DADO LIDO PARA W
00D0   00B9           00547         MOVWF   BUFFER_I2C      ; MOVE W PARA BUFFER_I2C
00D1   0008           00548         RETURN                  ; RETORNA
                      00549 
                      00550 ;*      *       *       *       *       *       *       *       *       *
                      00551 ;*          ROTINA PARA ENVIAR STOP-BIT PARADA EEPROM EXTERNA           *
                      00552 ;*      *       *       *       *       *       *       *       *       *
                      00553 
00D2                  00554 ENVIA_STOP
                      00555         
00D2   1683           00556         BANK1
00D3   1511           00557         BSF     SSPCON2,PEN     ; ENVIA STOP-BIT
00D4   1283           00558         BANK0
00D5   20A4           00559         CALL    AGUARDA_I2C     ; AGUARDA O BARRAMENTO FICAR LIVRE
00D6   0008           00560         RETURN                  ; RETORNA
                      00561 
                      00562 ;*      *       *       *       *       *       *       *       *       *
                      00563 ;*            ROTINA PARA ENVIAR DADOS PARA A EEPROM EXTERNA            *
                      00564 ;*      *       *       *       *       *       *       *       *       *
                      00565 
00D7                  00566 ENVIA_BYTE
                      00567         
00D7   0839           00568         MOVF    BUFFER_I2C,W    ; MOVE BYTE DE A SER
00D8   0093           00569         MOVWF   SSPBUF          ; ESCRITO PARA SSPBUF
00D9   20A4           00570         CALL    AGUARDA_I2C     ; AGUARDA O BARRAMENTO FICAR LIVRE
00DA   0008           00571         RETURN                  ; RETORNA
                      00572                                                                         
                      00573 ;*      *       *       *       *       *       *       *       *       *
                      00574 ;*               ROTINA PARA LER DADOS DA EEPROM EXTERNA                *
                      00575 ;*      *       *       *       *       *       *       *       *       *
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00576 
00DB                  00577 LE_I2C
                      00578 
00DB   20B3           00579         CALL    ENVIA_START     ; ENVIA START-BIT
00DC   20B8           00580         CALL    ENVIA_ENDERECO  ; ENVIA CONTROLE + ENDEREÇO
00DD   20C1           00581         CALL    ENVIA_RESTART   ; ENVIA RESTART
00DE   20C6           00582         CALL    ENVIA_LEITURA   ; ENVIA COMANDO PARA LEITURA
00DF   20CB           00583         CALL    LE_BYTE_I2C     ; LÊ O BYTE DA I2C
00E0   20AD           00584         CALL    ENVIA_NACK      ; ENVIA NACK
00E1   20D2           00585         CALL    ENVIA_STOP      ; ENVIA STOP-BIT
00E2   0839           00586         MOVF    BUFFER_I2C,W    ; MOVE O DADO LIDO PARA W
00E3   0008           00587         RETURN                  ; RETORNA DA ROTINA
                      00588 
                      00589 ;*      *       *       *       *       *       *       *       *       *
                      00590 ;*               ROTINA PARA ESCREVER DADOS NA EEPROM EXTERNA           *
                      00591 ;*      *       *       *       *       *       *       *       *       *
                      00592 
00E4                  00593 ESCREVE_I2C
                      00594 
00E4   20B3           00595         CALL    ENVIA_START     ; ENVIA START-BIT
00E5   20B8           00596         CALL    ENVIA_ENDERECO  ; ENVIA CONTROLE + ENDEREÇO
00E6   20D7           00597         CALL    ENVIA_BYTE      ; ENVIA BYTE PARA ESCRITA
00E7   20D2           00598         CALL    ENVIA_STOP      ; ENVIA STOP-BIT
00E8   3005           00599         MOVLW   .5              
00E9   2067           00600         CALL    DELAY_MS        ; TEMPO PRA GRAVAÇÃO
00EA   0008           00601         RETURN                  ; RETORNA DA SUB-ROTINA
                      00602 
                      00603 ;*      *       *       *       *       *       *       *       *       *
                      00604 ;*             ROTINA PARA RECUPERAR O DADO SALVO NA EEPROM             *
                      00605 ;*      *       *       *       *       *       *       *       *       *
                      00606 
00EB                  00607 RECUPERA_EEPROM
                      00608 
00EB   2062           00609         CALL    TOCA_BEEP       ; CHAMA ROTINA PARA TOCAR O BEEP
00EC   3080           00610         MOVLW   0x80
00ED   2070           00611         CALL    ENVIA_COMANDO   ; POSICIONA INÍCIO DA LINHA
00EE   01B8           00612         CLRF    ENDERECO_LO     ; ZERA O ENDEREÇO
00EF   209A           00613         CALL    LE_DADOS        ; LÊ DADOS DA I2C       
                      00614         
00F0   0064           00615         CLRWDT
00F1   1923           00616         BTFSC   TECLA_C         ; AGUARDA SOLTAR A TECLA
00F2   28F0           00617         GOTO    $-2
                      00618         
00F3   2062           00619         CALL    TOCA_BEEP       ; CHAMA ROTINA PARA TOCAR O BEEP
00F4   0008           00620         RETURN
                      00621                         
                      00622 ;*      *       *       *       *       *       *       *       *       *
                      00623 ;*                        CONFIGURACOES INICIAIS                        *
                      00624 ;*      *       *       *       *       *       *       *       *       *
                      00625 
00F5                  00626 CONFIG_
                      00627 
00F5   0185           00628         CLRF    PORTA           ; LIMPA O PORTA
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00F6   0186           00629         CLRF    PORTB           ; LIMPA O PORTB
00F7   0187           00630         CLRF    PORTC           ; LIMPA O PORTC
00F8   0188           00631         CLRF    PORTD           ; LIMPA O PORTD
00F9   0189           00632         CLRF    PORTE           ; LIMPA O PORTE
                      00633         
00FA   1683           00634         BANK1                   ; SELECIONA BANCO1 DE MEMÓRIA
                      00635         
00FB   30FF           00636         MOVLW   B'11111111'
00FC   0085           00637         MOVWF   TRISA
                      00638         
00FD   30C0           00639         MOVLW   B'11000000'
00FE   0086           00640         MOVWF   TRISB           ; CONFIGURA I/O DO PORTB
                      00641         
00FF   30D7           00642         MOVLW   B'11010111'
0100   0087           00643         MOVWF   TRISC           ; CONFIGURA I/O DO PORTB
                      00644         
0101   3000           00645         MOVLW   B'00000000'     ; CONFIGURA TODOS OS PINOS DESTE
0102   0088           00646         MOVWF   TRISD           ; PORTB COMO SAÍDA
                      00647         
0103   3001           00648         MOVLW   B'00000001'
0104   0089           00649         MOVWF   TRISE           ; CONFIGURA I/O DO PORTE
                      00650         
0105   308F           00651         MOVLW   B'10001111'     ; DESLIGA PULL-UPS
0106   0081           00652         MOVWF   OPTION_REG      ; WDT 1:128
                      00653         
0107   3020           00654         MOVLW   B'00100000'
0108   008C           00655         MOVWF   PIE1            ; HABILITA A INTERUPÇÃO SERIAL
                      00656         
0109   3060           00657         MOVLW   B'01100000'     
010A   008B           00658         MOVWF   INTCON          ; HABILITA A INTERRUPÇÃO DE TIMER 0
                      00659                                 ; LIGA A CHAVE GERAL DE INTERRUPÇÃO
                      00660         
010B   3007           00661         MOVLW   B'00000111'     ; DESLIGA OS A/D´S
010C   009F           00662         MOVWF   ADCON1
                      00663         
010D   3019           00664         MOVLW   .25
010E   0099           00665         MOVWF   SPBRG           ; PREPARA PARA FUNCIONAR A 9600bps
                      00666         
010F   3024           00667         MOVLW   B'00100100'
0110   0098           00668         MOVWF   TXSTA           ; CONFIGURA USART
                      00669         
0111   3009           00670         MOVLW   B'00001001'
0112   0093           00671         MOVWF   SSPADD
                      00672         
0113   3080           00673         MOVLW   B'10000000'
0114   0094           00674         MOVWF   SSPSTAT
                      00675         
0115   1283           00676         BANK0
                      00677         
0116   3028           00678         MOVLW   B'00101000'
0117   0094           00679         MOVWF   SSPCON
                      00680         
0118   3090           00681         MOVLW   B'10010000'
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0119   0098           00682         MOVWF   RCSTA           ; CONFIGURA USART
                      00683         
011A   1A03           00684         BTFSC   STATUS,NOT_TO   ; ESTOURO POR WDT?
011B   291B           00685         GOTO    $               ; NÃO, ENTÃO AGUARDA
                      00686                 
011C                  00687 LIMPEZA_DA_RAM
                      00688                                 ; ROTINA DE LIMPEZA DA RAM
                      00689                                 
011C   3020           00690         MOVLW   0x20
011D   0084           00691         MOVWF   FSR
011E   0180           00692         CLRF    INDF
011F   0A84           00693         INCF    FSR,F
0120   3080           00694         MOVLW   0x80
0121   0604           00695         XORWF   FSR,W
0122   1D03           00696         BTFSS   STATUS,Z
0123   291E           00697         GOTO    $-5
                      00698 
0124   178B           00699         BSF     INTCON,GIE      ; LIGA AS INTERRUPÇÕES
                      00700         
                      00701 ;*      *       *       *       *       *       *       *       *       *
                      00702 ;*                       INICIALIZAÇÃO DO DISPLAY                       *
                      00703 ;*      *       *       *       *       *       *       *       *       *
                      00704         
0125   3030           00705         MOVLW   0x30                    
0126   2070           00706         CALL    ENVIA_COMANDO           ; COMANDO DE INICIALIZAÇÃO
                      00707         
0127   3003           00708         MOVLW   .3                      
0128   2067           00709         CALL    DELAY_MS                ; DELAY DE 3ms
                      00710         
0129   3030           00711         MOVLW   0x30                    
012A   2070           00712         CALL    ENVIA_COMANDO           ; COMANDO DE INICIALIZAÇÃO      
                      00713         
012B   3030           00714         MOVLW   0x30                    
012C   2070           00715         CALL    ENVIA_COMANDO           ; COMANDO DE INICIALIZAÇÃO
                      00716         
012D   3038           00717         MOVLW   0x38                    
012E   2070           00718         CALL    ENVIA_COMANDO           ; INTERFACE DE 8 VIAS
                      00719         
012F   3001           00720         MOVLW   0x01                    
0130   2070           00721         CALL    ENVIA_COMANDO           ; LIMPA O DISPLAY
                      00722         
0131   3001           00723         MOVLW   .1
0132   2067           00724         CALL    DELAY_MS                ; CHAMA DELAY DE 3ms
                      00725         
0133   300C           00726         MOVLW   0x0C                    
0134   2070           00727         CALL    ENVIA_COMANDO           ; LIGAR O DISPLAY SEM CURSOR
                      00728         
0135   3006           00729         MOVLW   0x06                    
0136   2070           00730         CALL    ENVIA_COMANDO           ; LIGAR O DISPLAY SEM CURSOR
                      00731         
                      00732                                                                 
                      00733 ;*      *       *       *       *       *       *       *       *       *
                      00734 ;*                       INICIALIZAÇÃO DAS VARIÁVEIS                    *
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00735 ;*      *       *       *       *       *       *       *       *       *
                      00736         
0137   209A           00737         CALL    LE_DADOS                ; CHAMA ROTINA PARA CARREGAR O
                      00738                                         ; ÚLTIMO DADO SALVA NA EEPROM 
                      00739         
                      00740 ;*      *       *       *       *       *       *       *       *       *
                      00741 ;*                          ROTINA PRINCIPAL                            *
                      00742 ;*      *       *       *       *       *       *       *       *       *
                      00743 
0138                  00744 LOOP
0138   0064           00745         CLRWDT                  ; LIMPA O WATCHDOG
                      00746         
0139   1923           00747         BTFSC   TECLA_C         ; A TECLA ESTÁ PRESSIONADA?
013A   20EB           00748         CALL    RECUPERA_EEPROM ; SIM, ENTÃO RECUPERA OS DADOS DA EEPROM
                      00749 
013B   19A3           00750         BTFSC   TECLA_E         ; A TECLA ESTÁ PRESSIONADA?
013C   2088           00751         CALL    GUARDA_BUFFER   ; SIM, ENTÃO SALVA DADOS DO BUFFER NA EEPROM
013D   2938           00752         GOTO    LOOP            ; NÃO, ENTÃO VOLTA PARA LOOP
                      00753                         
                      00754 ;*      *       *       *       *       *       *       *       *       *
                      00755 ;*                           FIM DO PROGRAMA                            *
                      00756 ;*      *       *       *       *       *       *       *       *       *
                      00757 
                      00758 
                      00759         END                     ; FIM DO PROGRAMA
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE 16


SYMBOL TABLE
  LABEL                             VALUE 

ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
AGUARDA_I2C                       000000A4
BANK0                             BCF     STATUS,RP0
BANK1                             BSF     STATUS,RP0
BCLIE                             00000003
BCLIF                             00000003
BEEP                              PORTC,5
BF                                00000000
BRGH                              00000002
BUFFER0                           00000026
BUFFER1                           00000027
BUFFER10                          00000030
BUFFER11                          00000031
BUFFER12                          00000032
BUFFER13                          00000033
BUFFER14                          00000034
BUFFER15                          00000035
BUFFER2                           00000028
BUFFER3                           00000029
BUFFER4                           0000002A
BUFFER5                           0000002B
BUFFER6                           0000002C
BUFFER7                           0000002D
BUFFER8                           0000002E
BUFFER9                           0000002F
BUFFER_I2C                        00000039
BUS                               PORTD
C                                 00000000
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE 17


SYMBOL TABLE
  LABEL                             VALUE 

CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2H                            0000001C
CCPR2L                            0000001B
CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
CKE                               00000006
CKP                               00000004
COL1                              PORTA,4
COL2                              PORTA,5
COL3                              PORTE,0
CONFIG_                           000000F5
CREN                              00000004
CSRC                              00000007
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
DELAY_A                           0000006A
DELAY_MS                          00000067
D_A                               00000005
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
EN                                PORTE,2
ENDERECO_HI                       00000037
ENDERECO_LO                       00000038
ENVIA_BYTE                        000000D7
ENVIA_COMANDO                     00000070
ENVIA_COMANDO_INT                 0000007D
ENVIA_DADO                        00000071
ENVIA_DADO_INT                    0000007E
ENVIA_ENDERECO                    000000B8
ENVIA_LEITURA                     000000C6
ENVIA_NACK                        000000AD
ENVIA_RESTART                     000000C1
ENVIA_START                       000000B3
ENVIA_STOP                        000000D2
ESCREVE_I2C                       000000E4
F                                 00000001
FERR                              00000002
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE 18


SYMBOL TABLE
  LABEL                             VALUE 

FSR                               00000004
FSR_TEMP                          00000072
GCEN                              00000007
GIE                               00000007
GO                                00000002
GO_DONE                           00000002
GUARDA_A                          0000008C
GUARDA_BUFFER                     00000088
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IBF                               00000007
IBOV                              00000005
INDF                              00000000
INDICE                            00000024
INDICE_BUFFER                     00000036
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
LE_BYTE_I2C                       000000CB
LE_DADOS                          0000009A
LE_I2C                            000000DB
LIMPEZA_DA_RAM                    0000011C
LINHA_INF                         0xC0
LINHA_SUP                         0x80
LOOP                              00000138
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
OBF                               00000006
OERR                              00000001
OPTION_REG                        00000081
P                                 00000004
PCFG0                             00000000
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000002
PCLATH                            0000000A
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE 19


SYMBOL TABLE
  LABEL                             VALUE 

PCLATH_TEMP                       00000073
PCON                              0000008E
PEIE                              00000006
PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
PORTD                             00000008
PORTE                             00000009
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PSPIE                             00000007
PSPIF                             00000007
PSPMODE                           00000004
R                                 00000002
RBIE                              00000003
RBIF                              00000000
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
READ_WRITE                        00000002
RECUPERA_EEPROM                   000000EB
RP0                               00000005
RP1                               00000006
RS                                PORTE,1
RSEN                              00000001
RX9                               00000006
RX9D                              00000000
R_W                               00000002
S                                 00000003
SAI_INTERRUPCAO                   00000011
SALVA_CONTEXTO                    00000004
SEL_LINHA1                        B'00001110'
SEL_LINHA2                        B'00001101'
SEL_LINHA3                        B'00001011'
SEL_LINHA4                        B'00000111'
SEN                               00000000
SMP                               00000007
SPBRG                             00000099
SPEN                              00000007
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE 20


SYMBOL TABLE
  LABEL                             VALUE 

SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPCON2                           00000091
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
STATUS                            00000003
STATUS_TEMP                       00000071
SYNC                              00000004
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TECLADO1                          00000022
TECLADO2                          00000023
TECLA_0                           TECLADO1,0
TECLA_1                           TECLADO1,1
TECLA_2                           TECLADO1,2
TECLA_3                           TECLADO1,3
TECLA_4                           TECLADO1,4
TECLA_5                           TECLADO1,5
TECLA_6                           TECLADO1,6
TECLA_7                           TECLADO1,7
TECLA_8                           TECLADO2,0
TECLA_9                           TECLADO2,1
TECLA_C                           TECLADO2,2
TECLA_E                           TECLADO2,3
TEMP                              00000025
TEMPO1                            00000020
TEMPO2                            00000021
TEMPO_BEEP                        .10
TMR0                              00000001
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE 21


SYMBOL TABLE
  LABEL                             VALUE 

TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOCA_BEEP                         00000062
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRATA_SERIAL                      00000053
TRATA_SERIAL_A                    0000005A
TRATA_TIMER0                      0000001A
TRISA                             00000085
TRISB                             00000086
TRISC                             00000087
TRISD                             00000088
TRISE                             00000089
TRISE0                            00000000
TRISE1                            00000001
TRISE2                            00000002
TRMT                              00000001
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
UA                                00000001
VERIFICA_LINHA1                   00000023
VERIFICA_LINHA2                   0000002F
VERIFICA_LINHA3                   0000003B
VERIFICA_LINHA4                   00000047
W                                 00000000
WCOL                              00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
W_TEMP                            00000070
Z                                 00000002
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00000FCF
_CP_HALF                          00001FDF
_CP_OFF                           00003FFF
_CP_UPPER_256                     00002FEF
_DEBUG_OFF                        00003FFF
MPASM 03.80.04 Internal                               I2C.ASM   5-15-2005  19:09:17         PAGE 22


SYMBOL TABLE
  LABEL                             VALUE 

_DEBUG_ON                         000037FF
_HS_OSC                           00003FFE
_LP_OSC                           00003FFC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_WRT_ENABLE_OFF                   00003DFF
_WRT_ENABLE_ON                    00003FFF
_XT_OSC                           00003FFD
__16F877                          00000001


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : X---XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXX--
2000 : -------X-------- ---------------- ---------------- ----------------
2100 : XXXXXXXXXXXXXXXX ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:   315
Program Memory Words Free:  7877


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,    23 suppressed

